# Документация по работе приложения #


# Возможности: #
- ####Учетная запись пользователя
  - Удаление
  - Изменение имени, пароля, email
  - ~~Друзья?~~
- ####Взаимодейсвие с курсами
  - Поиск курса
  - Поступление на курс, при этом он добавляется в личный кабинет
  - Уход с курса
  - "Мои курсы"
    - Прогресс каждого курса
    - Домашнее задание
    - Работа над ошибками
    - Невозможность продолжать обучение пока не выполнил работу над ошибками
  - ~~Оценивание курса?~~

# Реализация
Весь сайт держится на одной  MySQL базе данных - **fizportal_courses**
База данных имеет 7 таблиц:
- **users** - список пользователей и их данные.
- **courses** - список курсов и их данные.
- **themes** - список тем(каждая тема связана с строкой из таблицы **courses** внешним ключом).
- **users_courses** - таблица, реализующая связь "многие ко многим". Сопоставлет пользователя и курс, на который он записан.
- **tasks** - список задач(каждая задача связана с строкой из таблицы **themes** внешним ключом).
- **users_homework** - таблица, реализующая связь "многие ко многим". Сопоставляет пользователя и задачу из его домашней работы.
- **friends** -  таблица, реализующая связь "многие ко многим". Сопоставляет пользователя и его друга.
***
За обеспечения взаимодействия
**user->server->database**
Отвечает несколько классов:
- **Validator** - Проверяет данные на корректность.
- **User_session** - класс управления сессией пользователя и cookie.
- **User** - Класс для работы приложения с пользователем(его данными). Передает данные классу-валидатору **Validator**, хэширует пароль, создает сессию с помощью класса **User_session** и передает управление классу **Users_table**.
- **Users_table** - Опрерирует обьектом класса **User**. Вносит уже готовые данные в таблицу **users**.
***
За создание и редактирование курсов отвечают классы:
- **Course** - Создает обьект курса для дальнейшей работы с ним.
- **Course_table** - Оперирует обьектом класса **Course**. Сохраняет курс в таблице **courses**.
- **Theme** - Создает обьект темы для дальнейшей работы с ней.
- **Themes_table** - Оперирует обьектом класса **Theme**. Сохраняет тему в таблице **themes**.
***
Отображением страниц управляет Фреймворк [**Twig**](https://twig.symfony.com/) посредством написанного мною класса **Render**. Он использует шаблоны отображения , лежащие в папке **templates**
***
Классы имеющие префикс ***_table*** реализуют интерфейс **Table**.
В этих классах используется фреймворк [**ReadBeanPHP**](https://redbeanphp.com/index.php) для взаимодействия с MySQL.
***
За зависимости отвечает [**Composer**](https://getcomposer.org/)

Чтоб подтянуть зависимости выполнить:
`$ composer install`
***
##Работа c cookie##
В таблице **users** есть специальное поле ***hash***, которое хранит значение хэша, присваемого пользователю при авторизации. При создании cookie, этот же хеш сохраняется на клиенте и в дальнейшем сверяется с хешем из базы.

Хэш получается из случайной последовательности **6 символов** после **md5** шифрования
Пример хэша:
`e80b5017098950fc58aad83c8c14978e`
***
##Алгоритм авторизации
1. Пользователь вводит свои данные(name, password)
2. Создается обьект класса **User**
3. Создается обьект класса **Validator** и ему передеается обьект пользователя для проверки корректности данных и заполненности полей
4. Если **Validator** возвращает `status=>"OK"`, создается обьект класса **Users_table** для работы с БД, и там происходит сверка введенных данных
5. Если **Users_table** вернул **id** пользователя(авторизация успешна), создается обьект класса **User_session** для создания сессии и cookie
6. После всех этапов происходит редирект.

Регистрация происходит по тому же принципу.
Пароли дважды проходят **md5** шифрование




